# í”„ë¡ íŠ¸ì—”ë“œ ìš”êµ¬ì‚¬í•­

---

## 1. íŒŒì¼ ì—…ë¡œë“œ

### 1-1. ì—…ë¡œë“œ ì˜ì—­

- íŠ¹ì • ì˜ì—­ì— **íŒŒì¼ ë“œë˜ê·¸** ë˜ëŠ” **í´ë¦­** ì‹œ ëª¨ë‹¬ì°½ í‘œì‹œ

### 1-2. ì—…ë¡œë“œ ëª¨ë‹¬ì°½

ëª¨ë‹¬ì—ì„œ ë‹¤ìŒ í•­ëª©ì„ ë°°ì¹˜/ìˆ˜ì • ê°€ëŠ¥:

| í•­ëª© | ì„¤ëª… |
|---|---|
| `projectName` | í”„ë¡œì íŠ¸ëª… (ìˆ˜ì • ê°€ëŠ¥) |
| `systems[]` | ì‹œìŠ¤í…œë³„ SP íŒŒì¼ ëª©ë¡ (ë“œë˜ê·¸ë¡œ ì¬ë°°ì¹˜) |
| `ddl[]` | DDL íŒŒì¼ ëª©ë¡ (ë“œë˜ê·¸ë¡œ ì¬ë°°ì¹˜) |
| ì¶”ê°€ ì—…ë¡œë“œ | ì¶”ê°€ íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ |
ì´ë•Œ ì‹œìŠ¤í…œëª…ë„ ìˆ˜ì •ê°€ëŠ¥ ì¦‰ ë‚´ê°€ ë¶„ì„í•  ë””ë ‰í„°ë¦¬ êµ¬ì¡°ë¥¼ ì—¬ê¸°ì„œ ê²°ì •í•œë‹¤ê³  ë³´ë©´ ë¨ 
ì—…ë¡œë“œì‹œ ANTLR ìš”ì²­ ìŠ¤í™ì„ ì°¸ê³ 

### 1-3. ìë™ êµ¬ì¡° ì¸ì‹

ì—…ë¡œë“œëœ íŒŒì¼ì˜ **ë””ë ‰í† ë¦¬ êµ¬ì¡°**ë¥¼ ë¶„ì„í•˜ì—¬ ìë™ ë°°ì¹˜:

```
MyProject/              â†’ projectName: "MyProject"
â”œâ”€â”€ ddl/
â”‚   â””â”€â”€ schema.sql      â†’ ddl: ["schema.sql"]
â”œâ”€â”€ user/
â”‚   â”œâ”€â”€ UserService.java
â”‚   â””â”€â”€ UserController.java   â†’ systems[0]: {name: "user", sp: [...]}
â””â”€â”€ order/
    â””â”€â”€ OrderService.java     â†’ systems[1]: {name: "order", sp: [...]}
```

**ìë™ ì¸ì‹ ê·œì¹™:**
1. ìµœìƒìœ„ í´ë”ëª… â†’ `projectName`
2. `ddl` í´ë” ë‚´ íŒŒì¼ â†’ `ddl[]` ë°°ì—´
3. ë‚˜ë¨¸ì§€ í´ë” â†’ `systems[]` ë°°ì—´ (í´ë”ëª… = ì‹œìŠ¤í…œëª…)

---

## 2. ì‹œê°í™”

### 2-1. D3 ê·¸ë˜í”„ (Neo4j ìŠ¤íƒ€ì¼)

- **ë°ì´í„° ì†ŒìŠ¤**: `/cypherQuery/` ì‘ë‹µì˜ `graph` ë°ì´í„°
- **ìš©ë„**: ì „ì²´ êµ¬ì¡° íƒìƒ‰

| ì¸í„°ë™ì…˜ | ë™ì‘ |
|---|---|
| ë”ë¸”í´ë¦­ | í•´ë‹¹ ë…¸ë“œì—ì„œ 1ë‹¨ê³„ ê¹Šì´ í™•ì¥ |
| ì¤Œì¸/ì•„ì›ƒ | ë§ˆìš°ìŠ¤ íœ  |
| ë…¸ë“œ ë“œë˜ê·¸ | ë…¸ë“œ ìœ„ì¹˜ ì´ë™ |

### 2-2. Mermaid í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

- **ë°ì´í„° ì†ŒìŠ¤**: `/convert/` (strategy: `architecture`) ì‘ë‹µì˜ `diagram`
- **ìš©ë„**: ì„ íƒí•œ í´ë˜ìŠ¤ì˜ UML ë‹¤ì´ì–´ê·¸ë¨

| ê¸°ëŠ¥ | ì„¤ëª… |
|---|---|
| ê²€ìƒ‰ì°½ | í´ë˜ìŠ¤ëª… ì…ë ¥ â†’ í•´ë‹¹ í´ë˜ìŠ¤ + 1ë‹¨ê³„ ì—°ê²°ëœ í´ë˜ìŠ¤ë§Œ í‘œì‹œ |
| í™•ì¥ | í´ë˜ìŠ¤ í´ë¦­ â†’ í™•ì¥ ë²„íŠ¼ â†’ 1ë‹¨ê³„ ê¹Šì´ í™•ì¥ |
| ì¶•ì†Œ | ìºì‹±ëœ ì´ì „ ìƒíƒœë¡œ ë³µì› |

**ì£¼ì˜**: ëª¨ë“  ë‚´ìš©ì„ ë‹¤ ë³´ì—¬ì£¼ë©´ ì•ˆë¨. ê²€ìƒ‰ì„ í†µí•´ **ìš”ì²­í•œ ë¶€ë¶„ë§Œ** ì „í™˜í•´ì„œ í‘œì‹œ

---

## 3. í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ í”Œë¡œìš°

### 3-1. ê¸°ë³¸ í”Œë¡œìš°

```
1. ê²€ìƒ‰ì°½ì— í´ë˜ìŠ¤ëª… ì…ë ¥ (ì˜ˆ: "UserService")
       â†“
2. ê·¸ë˜í”„ ë°ì´í„°ì—ì„œ í•„í„°ë§ â†’ í›„ë³´ ëª©ë¡ í‘œì‹œ
   - user/UserService
   - admin/UserService
       â†“
3. íŠ¹ì • í´ë˜ìŠ¤ ì„ íƒ (systemName/className í˜•ì‹)
       â†“
4. POST /convert/
   {
     "strategy": "architecture",
     "target": "mermaid",
     "projectName": "MyProject",
     "classNames": ["user/UserService"]
   }
       â†“
5. ë°±ì—”ë“œ: Neo4jì—ì„œ í•´ë‹¹ í´ë˜ìŠ¤ + 1ë‹¨ê³„ ì—°ê²° í´ë˜ìŠ¤ ì¡°íšŒ â†’ Mermaid ìƒì„±
       â†“
6. ë‹¤ì´ì–´ê·¸ë¨ í‘œì‹œ
```

### 3-2. í™•ì¥ í”Œë¡œìš°

```
1. ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ í´ë˜ìŠ¤ í´ë¦­
       â†“
2. í™•ì¥ ë²„íŠ¼ í´ë¦­
       â†“
3. classNamesì— í•´ë‹¹ í´ë˜ìŠ¤ ì¶”ê°€ â†’ ì¬ìš”ì²­
   classNames: ["user/UserService", "user/UserRepository"]
       â†“
4. ì—…ë°ì´íŠ¸ëœ ë‹¤ì´ì–´ê·¸ë¨ í‘œì‹œ
```

### 3-3. ì¶•ì†Œ í”Œë¡œìš°

```
1. ì¶•ì†Œ ë²„íŠ¼ í´ë¦­
       â†“
2. ìºì‹±ëœ ì´ì „ ìƒíƒœë¡œ ë³µì› (API ì¬ìš”ì²­ ì—†ì´)
```

### 3-4. ë™ì¼ í´ë˜ìŠ¤ëª… ì²˜ë¦¬

í´ë˜ìŠ¤ëª… ê²€ìƒ‰ ì‹œ **ì—¬ëŸ¬ ì‹œìŠ¤í…œì— ë™ì¼í•œ ì´ë¦„**ì´ ìˆìœ¼ë©´:

| ì‹œìŠ¤í…œ | í´ë˜ìŠ¤ëª… | classNames í˜•ì‹ |
|---|---|---|
| user | UserService | `user/UserService` |
| admin | UserService | `admin/UserService` |

â†’ ì‚¬ìš©ìê°€ **íŠ¹ì • í´ë˜ìŠ¤ë¥¼ ì„ íƒ**í•œ í›„ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±

---

## 4. UI êµ¬ì„±

### 4-1. ì£¼ìš” ì˜ì—­ (3ê°œ)

| ì˜ì—­ | ë‚´ìš© |
|---|---|
| **ì—…ë¡œë“œ** | íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­, ì—…ë¡œë“œëœ íŒŒì¼ ë‚´ìš©, ANTLR íŒŒì‹± ê²°ê³¼ |
| **ê·¸ë˜í”„** | D3 ê·¸ë˜í”„ (Neo4j ìŠ¤íƒ€ì¼ ì „ì²´ êµ¬ì¡° íƒìƒ‰) |
| **ì „í™˜ê²°ê³¼** | Mermaid ë‹¤ì´ì–´ê·¸ë¨, ì½”ë“œ ì—ë””í„° (ìƒì„±ëœ ì½”ë“œ) |

### 4-2. íƒ­ êµ¬ì„±

- ê° ì˜ì—­ì€ **íƒ­ ë°©ì‹**ìœ¼ë¡œ êµ¬ë¶„
- ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µì€ **ì‹¤ì‹œê°„**ìœ¼ë¡œ ê³„ì† ë°›ì•„ì„œ í‘œì‹œ
- íŒŒì¼ ì—…ë¡œë“œ ì‹œ:
  1. ì—…ë¡œë“œëœ íŒŒì¼ ë‚´ìš© í‘œì‹œ
  2. ANTLR íŒŒì‹± ê²°ê³¼ í‘œì‹œ
  3. ê·¸ë˜í”„ ì „í™˜ ê²°ê³¼ ì‹¤ì‹œê°„ í‘œì‹œ

### 4-3. ì½”ë“œ ì—ë””í„° (Convert ê²°ê³¼ í‘œì‹œ)

**ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ë°›ëŠ” ì½”ë“œ**ë¥¼ IDEì²˜ëŸ¼ í‘œì‹œ:

| ë¼ì´ë¸ŒëŸ¬ë¦¬ | íŠ¹ì§• |
|---|---|
| Monaco Editor | VS Code ê¸°ë°˜, í’€ ê¸°ëŠ¥ |
| CodeMirror | ê²½ëŸ‰, ë¹ ë¦„ |
| Prism.js | í•˜ì´ë¼ì´íŠ¸ë§Œ (ì½ê¸° ì „ìš©) |

**êµ¬í˜„ ì˜ˆì‹œ:**

```javascript
// ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ì½”ë“œ ìˆ˜ì‹  ì‹œ ì—ë””í„°ì— ì¶”ê°€
onEvent('data', (event) => {
  if (event.file_type === 'entity_class' || event.file_type === 'service_class') {
    // ìƒˆ íƒ­ ìƒì„± + ì½”ë“œ ì—ë””í„°ì— í‘œì‹œ
    createEditorTab({
      fileName: event.file_name,      // "UserService.java"
      code: event.code,               // ì‹¤ì œ ì½”ë“œ
      language: detectLanguage(event.file_name)  // "java", "sql" ë“±
    });
  }
});
```

**ì§€ì› ì–¸ì–´:**

| ì „ëµ | íŒŒì¼ íƒ€ì… | ì–¸ì–´ |
|---|---|---|
| framework | `*.java` | Java |
| dbms | `*.sql` | SQL (Oracle/PostgreSQL) |

**ê¸°ëŠ¥:**
- êµ¬ë¬¸ í•˜ì´ë¼ì´íŒ…
- ì¤„ ë²ˆí˜¸
- íŒŒì¼ë³„ íƒ­ ë¶„ë¦¬
- ë³µì‚¬ ë²„íŠ¼

---

## 5. ìŠ¤íŠ¸ë¦¬ë° ì´ë²¤íŠ¸ ìŠ¤í™ (NDJSON)

ëª¨ë“  ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µì€ **NDJSON** í˜•ì‹ (ì¤„ë°”ê¿ˆìœ¼ë¡œ JSON ê°ì²´ êµ¬ë¶„)

### 5-1. ê³µí†µ ì´ë²¤íŠ¸ íƒ€ì…

| type | ìš©ë„ | í•„ë“œ |
|---|---|---|
| `message` | ì§„í–‰ ìƒíƒœ ë©”ì‹œì§€ | `content` |
| `data` | ê²°ê³¼ ë°ì´í„° | `file_type`, `file_name`, `code`, ... |
| `status` | ë‹¨ê³„ ì§„í–‰ ìƒíƒœ | `step`, `done` |
| `error` | ì—ëŸ¬ ë°œìƒ | `content`, `errorType`, `traceId` |
| `complete` | ìŠ¤íŠ¸ë¦¼ ì •ìƒ ì™„ë£Œ | `summary` (ì„ íƒ) |

---

### 5-2. Understanding ì´ë²¤íŠ¸ (`/cypherQuery/`)

**ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© í‘œì‹œ ê°€ëŠ¥:**

```json
{"type": "data", "graph": {...}, "line_number": 45, "analysis_progress": 23, "current_file": "user-UserService.java"}
{"type": "data", "graph": {...}, "line_number": 120, "analysis_progress": 67, "current_file": "user-UserService.java"}
{"type": "data", "graph": {...}, "line_number": 180, "analysis_progress": 100, "current_file": "user-UserService.java"}
{"type": "complete"}
```

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|---|---|---|
| `graph` | object | D3ìš© ê·¸ë˜í”„ ë°ì´í„° (nodes, links) |
| `line_number` | number | í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ ë¼ì¸ ë²ˆí˜¸ |
| `analysis_progress` | number | ì§„í–‰ë¥  (0~100%) |
| `current_file` | string | í˜„ì¬ ë¶„ì„ ì¤‘ì¸ íŒŒì¼ (`folder-fileName`) |

**í”„ë¡ íŠ¸ UI ì˜ˆì‹œ:**
```
ğŸ“‚ user-UserService.java
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 67% (120/180 lines)
```

---

### 5-3. Framework Convert ì´ë²¤íŠ¸ (`/convert/` strategy: `framework`)

**5ë‹¨ê³„ ì§„í–‰:**

| Step | ì„¤ëª… | ì´ë²¤íŠ¸ |
|---|---|---|
| 1 | Entity ìƒì„± | `emit_status(1, done=true)` |
| 2 | Repository ìƒì„± | `emit_status(2, done=true)` |
| 3 | Service Skeleton | `emit_status(3, done=true)` |
| 4 | Service Body + Controller | `emit_status(4, done=true)` |
| 5 | Config + Main | `emit_status(5, done=true)` |

**ì „ì²´ ìŠ¤íŠ¸ë¦¼ ì˜ˆì‹œ:**

```json
{"type": "data", "file_type": "project_name", "project_name": "MyProject"}
{"type": "message", "content": "Starting framework conversion"}
{"type": "data", "file_type": "entity_class", "file_name": "User.java", "code": "..."}
{"type": "data", "file_type": "entity_class", "file_name": "Account.java", "code": "..."}
{"type": "message", "content": "Generating Entities completed"}
{"type": "status", "step": 1, "done": true}
{"type": "data", "file_type": "repository_class", "file_name": "UserRepository.java", "code": "..."}
{"type": "message", "content": "Generating Repositories completed"}
{"type": "status", "step": 2, "done": true}
{"type": "message", "content": "Processing UserService"}
{"type": "data", "file_type": "command_class", "file_name": "CreateUserCommand.java", "code": "..."}
{"type": "message", "content": "UserService - Service Skeleton"}
{"type": "status", "step": 3, "done": true}
{"type": "data", "file_type": "service_class", "file_name": "UserService.java", "code": "..."}
{"type": "data", "file_type": "controller_class", "file_name": "UserController.java", "code": "..."}
{"type": "message", "content": "UserService - Service Body & Controller"}
{"type": "message", "content": "UserService - Completed"}
{"type": "status", "step": 4, "done": true}
{"type": "message", "content": "Generating Config Files"}
{"type": "data", "file_type": "pom", "file_name": "pom.xml", "code": "..."}
{"type": "data", "file_type": "properties", "file_name": "application.properties", "code": "..."}
{"type": "data", "file_type": "main", "file_name": "MyProjectApplication.java", "code": "..."}
{"type": "status", "step": 5, "done": true}
{"type": "complete"}
```

**file_type ì¢…ë¥˜:**

| file_type | ì„¤ëª… |
|---|---|
| `project_name` | í”„ë¡œì íŠ¸ ì´ë¦„ (ìµœì´ˆ 1íšŒ) |
| `entity_class` | Entity í´ë˜ìŠ¤ |
| `repository_class` | Repository ì¸í„°í˜ì´ìŠ¤ |
| `command_class` | Command DTO |
| `service_class` | Service í´ë˜ìŠ¤ |
| `controller_class` | Controller í´ë˜ìŠ¤ |
| `pom` | pom.xml |
| `properties` | application.properties |
| `main` | Application ë©”ì¸ í´ë˜ìŠ¤ |

**í”„ë¡ íŠ¸ UI ì˜ˆì‹œ:**
```
Framework Convert Progress
[âœ“] Step 1: Entity ìƒì„±
[âœ“] Step 2: Repository ìƒì„±
[â—] Step 3: Service Skeleton (Processing...)
[ ] Step 4: Service + Controller
[ ] Step 5: Config + Main
```

---

### 5-4. DBMS Convert ì´ë²¤íŠ¸ (`/convert/` strategy: `dbms`)

**íŒŒì¼ë³„ ë³€í™˜:**

```json
{"type": "message", "content": "Converting proc/get_user.sql (3 procedure(s))"}
{"type": "data", "file_type": "converted_sp", "file_name": "get_user.sql", "folder_name": "proc", "code": "...", "summary": "Converted to ORACLE for get_user_proc"}
{"type": "message", "content": "Conversion completed for proc/get_user.sql"}
{"type": "message", "content": "DBMS conversion completed â†’ ORACLE"}
{"type": "complete"}
```

| í•„ë“œ | ì„¤ëª… |
|---|---|
| `file_type` | `converted_sp` |
| `file_name` | íŒŒì¼ëª… |
| `folder_name` | ì‹œìŠ¤í…œëª… |
| `code` | ë³€í™˜ëœ ì½”ë“œ |
| `summary` | ë³€í™˜ ìš”ì•½ |

---

### 5-5. Architecture Convert ì´ë²¤íŠ¸ (`/convert/` strategy: `architecture`)

```json
{"type": "message", "content": "í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ì‹œì‘: 2ê°œ í´ë˜ìŠ¤"}
{"type": "message", "content": "ì¡°íšŒ ì™„ë£Œ: 5ê°œ í´ë˜ìŠ¤, 3ê°œ ê´€ê³„"}
{"type": "data", "file_type": "mermaid_diagram", "diagram": "```mermaid\nclassDiagram\n...", "class_count": 5, "relationship_count": 3}
{"type": "message", "content": "í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ì™„ë£Œ"}
{"type": "complete"}
```

| í•„ë“œ | ì„¤ëª… |
|---|---|
| `file_type` | `mermaid_diagram` |
| `diagram` | Mermaid ì½”ë“œ (ë§ˆí¬ë‹¤ìš´ í¬í•¨) |
| `class_count` | í´ë˜ìŠ¤ ìˆ˜ |
| `relationship_count` | ê´€ê³„ ìˆ˜ |

---

### 5-6. í”„ë¡ íŠ¸ ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ ì˜ˆì‹œ

```javascript
async function handleStream(response, onEvent) {
  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  let buffer = '';
  
  while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    
    buffer += decoder.decode(value, { stream: true });
    const lines = buffer.split('\n');
    buffer = lines.pop();
    
    for (const line of lines) {
      if (!line.trim()) continue;
      const event = JSON.parse(line);
      onEvent(event);
    }
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
handleStream(response, (event) => {
  switch (event.type) {
    case 'message':
      updateStatusText(event.content);
      break;
    case 'data':
      if (event.file_type === 'entity_class') {
        addEditorTab(event.file_name, event.code, 'java');
      }
      if (event.line_number) {
        updateProgress(event.analysis_progress, event.line_number, event.current_file);
      }
      break;
    case 'status':
      updateStepProgress(event.step, event.done);
      break;
    case 'complete':
      showCompleteMessage();
      break;
    case 'error':
      showError(event.content, event.traceId);
      break;
  }
});
```

---

## 6. ìºì‹± ì „ëµ

```javascript
// í™•ì¥/ì¶•ì†Œ ì‹œ ìºì‹± í™œìš©
const diagramCache = {
  "user/UserService": { 
    diagram: "...", 
    classNames: ["user/UserService", "user/UserRepository"] 
  }
};

// ì¶•ì†Œ ì‹œ: ìºì‹œëœ ì´ì „ ìƒíƒœë¡œ ë³µì› (API ì¬ìš”ì²­ ì—†ì´)
// í™•ì¥ ì‹œ: ìºì‹œ í™•ì¸ â†’ ì—†ìœ¼ë©´ API ìš”ì²­
```

---

## 7. í•µì‹¬ í¬ì¸íŠ¸

1. **ë§¤ë²ˆ ì „ì²´ë¥¼ ì „í™˜í•˜ëŠ” ê²Œ ì•„ë‹˜** â†’ ìš”ì²­í•œ ë¶€ë¶„ë§Œ ì „í™˜
2. ê²€ìƒ‰ ì‹œ í•´ë‹¹ í´ë˜ìŠ¤ì™€ **1ë‹¨ê³„ ì—°ê²°ëœ ê´€ê³„ë§Œ** ì¡°íšŒ
3. ë™ì¼ í´ë˜ìŠ¤ëª…ì€ **ì‹œìŠ¤í…œëª…ìœ¼ë¡œ êµ¬ë¶„** (`systemName/className`)
4. í™•ì¥/ì¶•ì†ŒëŠ” **ìºì‹±**ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
5. **ìŠ¤íŠ¸ë¦¬ë° ì§„í–‰ ìƒí™© í‘œì‹œ**:
   - Understanding: `line_number`, `analysis_progress`, `current_file`
   - Framework Convert: `step` 1~5 ë‹¨ê³„
   - DBMS Convert: íŒŒì¼ë³„ `message`
   - Architecture: í´ë˜ìŠ¤/ê´€ê³„ ìˆ˜
